<script>
(function() {

const CALLBACK_MAX_WAIT = 3000;
const CALLBACK_EVENT_TIMEOUT = 2000;
const CALLBACK_DELAY = 300;

const generateTransactionId = () => {
  const base36Timestamp = Date.now().toString(36);
  const MAX_INT = 2 ** 53 - 1;
  const base36RandomInt = Math.floor(Math.random() * MAX_INT).toString(36);
  return `${base36Timestamp}${base36RandomInt}`;
};

const setUrlParams = (source, campaign, trxId) => {
  const utmParams = `&utm_medium=paywall&utm_source=${source}&utm_campaign=${campaign}`;
  const logintxidParam = `logintxid=${trxId}`;
  const sep = `?`;
  const nextParam = `&next=${encodeURIComponent(
    window.location.pathname + window.location.search + sep + logintxidParam + utmParams,
  )}`;
  return `${nextParam}&${logintxidParam}${utmParams}`;
};

const trackLoginPaywallEvent = (action, cb) => {
  if (window.LorienDispatch) {
    const payload = {
      structuredEvent: {
        eventCategory: 'Funnel Tracking',
        eventAction: action,
      },
    };
    if (typeof cb === 'function') {
      // Never wait longer than CALLBACK_MAX_WAIT
      setTimeout(() => {
        cb();
      }, CALLBACK_MAX_WAIT);
      payload.eventTimeout = CALLBACK_EVENT_TIMEOUT;
      payload.eventCallback = cb;
    }
    window.LorienDispatch.dispatchEvent('loginWallEvent', payload);
  } else if (typeof cb === 'function') {
    cb();
  }
};

const trackLoginWallClick = (elem, action) => {
  elem.addEventListener('click', function (event) {
    event.preventDefault();
    const url = event.currentTarget.href;
    const callbackToRedirectUser = () => {
      setTimeout(() => {
        window.location.href = url;
      }, CALLBACK_DELAY);
    };
    trackLoginPaywallEvent(action, callbackToRedirectUser);
  });
};

const loginRequiredPaywall = (options) => {
  const trxId = generateTransactionId();
  const pwCreateLink = document.getElementById('js-paywall-create-account-link');
  const pwLoginLink = document.getElementById('js-paywall-login-link');
  const createLinkUrl =
    pwCreateLink.href + setUrlParams(options.channel, 'login-paywall-signup', trxId);
  pwCreateLink.href = createLinkUrl;
  const loginLinkUrl =
    pwLoginLink.href + setUrlParams(options.channel, 'login-paywall-logins', trxId);
  pwLoginLink.href = loginLinkUrl;

  window.dataLayer.push({
    logintxid: trxId,
  });

  trackLoginPaywallEvent('Login Walled Page Landed');
  trackLoginWallClick(pwCreateLink, 'Signup link clicked');
  trackLoginWallClick(pwLoginLink, 'Login link clicked');
};

window.login_html_utils = {
  loginRequiredPaywall,
}

}());
</script>


<style>
@media screen and (max-width: 768px) {
  .paywall-css-container {
    padding-left: 10px;
    padding-right: 10px;
  }
}

body.gallery .paywall-css-container {
  background-color: black;
}
body.videosite .paywall-css-container {
  background-color: black;
  position: relative;
  top: -200px;
  margin-bottom: -200px;
}

.article.-rich {
  background: black;
}
.article.-rich .article__byline,
.article.-rich .article__body > div:first-child, /* Zephr rendered fade element */
.article.-rich .zephr-paywall-bottom-container {
  display: none;
}

.article.-rich .paywall-css-container {
  background: black;
  margin: auto;
  padding-top: 3em;
  padding-bottom: 3em;
}

@media screen and (min-width: 768px) {
  .article.-rich .paywall-css-container {
    width: calc(100% * 10/12);
  }
}

@media screen and (min-width: 1024px) {
  .article.-rich .paywall-css-container {
    width: calc((100% - 48px) * 8/12);
    max-width: 850px;
  }
}

body.videosite .paywall-css-container::before {
  content: "";
  display: block;
  position: absolute;
  width: 100%;
  height: 200px;
  top: -200px;
  left: 0;
  padding: 0;
  background: rgba(255, 255, 255, 0);
  background: -webkit-gradient(
    linear,
    left bottom,
    left top,
    color-stop(35%, black),
    to(rgba(255, 255, 255, 0))
  );
  background: linear-gradient(to top, black 35%, rgba(255, 255, 255, 0) 100%);
  background: -webkit-gradient(
    linear,
    left bottom,
    left top,
    from(rgba(0, 0, 0, 1)),
    color-stop(50%, rgba(0, 0, 0, 0.3)),
    color-stop(65%, rgba(0, 0, 0, 0.15)),
    color-stop(75.5%, rgba(0, 0, 0, 0.075)),
    color-stop(82.85%, rgba(0, 0, 0, 0.037)),
    color-stop(88%, rgba(0, 0, 0, 0.019)),
    to(rgba(0, 0, 0, 0))
  );
  background: linear-gradient(
    to top,
    rgba(0, 0, 0, 1) 0%,
    rgba(0, 0, 0, 0.3) 50%,
    rgba(0, 0, 0, 0.15) 65%,
    rgba(0, 0, 0, 0.075) 75.5%,
    rgba(0, 0, 0, 0.037) 82.85%,
    rgba(0, 0, 0, 0.019) 88%,
    rgba(0, 0, 0, 0) 100%
  );
}

.video-similar-widget__container {
  display: none;
}

.zephr-video-cover {
  display: inline !important;
}

.discussion-container {
  display: none !important;
}
</style>

<script src="https://mpcdn.kalevamedia.fi/staticfiles/paywall/js/paywallContent.8b0d44342e7d.js" type='text/javascript'></script>
<script src="https://mpcdn.kalevamedia.fi/staticfiles/paywall/js/paywall.04adef173f57.js" type='text/javascript'></script>

<link href='https://fonts.googleapis.com/css?family=Tinos:400,400italic%7COpen+Sans:300italic,400italic,400,300,600,700,800%7COpen+Sans+Condensed:300,700' rel='stylesheet' type='text/css'>

<div id="paywall-container" class="paywall-css-container">
    <div class="pw-login-required">
      <h5 class="pw-login-required__title">{{ title }}</h5>
      <div class="pw-login-required__description">{{ description }}</div>
      <a id="js-paywall-create-account-link" href="{{ create-account-link-url }}" class="km-button-rounded km-button-rounded__brown no-link-styles">{{ create-account-link-text }}</a>
      <a id="js-paywall-login-link" href="{{ login-link-url }}" class="km-button-rounded no-link-styles">{{ login-link-text }}</a>
    </div>
</div>


<script>
function initPaywall() {
  console.log('initPaywall');
  window.login_html_utils.loginRequiredPaywall({
    channel: window.digitalData.channel.title,
  });
  const darkTheme = ['body.videosite', 'body.gallery', '.article.-rich'].some(cls => document.querySelector(cls));
  console.log('darkTheme:', !!darkTheme);
  document.getElementById('js-paywall-login-link').classList.add(
    darkTheme ? 'km-button-rounded__black-outlined' : 'km-button-rounded__white-outlined'
  )
  document.getElementById('paywall-container').classList.add(
    darkTheme ? '-theme-dark' : '-theme-normal'
  )
  if (darkTheme) {
    document.querySelector('.article.-rich')?.classList.add('-with-paywall-dark');
  }
}
if (document.readyState === 'complete') {
  initPaywall();
} else {
  window.addEventListener('load', initPaywall);
}
</script>
